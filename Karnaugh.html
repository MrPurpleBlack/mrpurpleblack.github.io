<html>
    <head>
        <title>Построение логических выражений</title>
        <meta content="text/html; charset=utf-16" />
        <link rel="stylesheet" type="text/css" href="styles.css"/>
        <header align="center"></header>
    </head>
    <body>
        <div id="interface">
            <div id="input">
                <fieldset>
                    <legend>Ввод данных</legend>
                    <form name="DataInput">
						<div id="TT">
							<span id="Vars">X<sub>0</sub>X<sub>1</sub>X<sub>2</sub>X<sub>3</sub></span>
						<div>
						</div>
							<textarea type="text" name="TruthTable" id="TruthTable" readonly="true">0 0 0 0 0 0 0 1 0 0 1 0 0 0 1 1 0 1 0 0 0 1 0 1 0 1 1 0 0 1 1 1 1 0 0 0 1 0 0 1 1 0 1 0 1 0 1 1 1 1 0 0 1 1 0 1 1 1 1 0 1 1 1 1</textarea>
                        </div>
						<textarea type="text" name="exp" id="exp" maxLength="16" onKeyUp="if(/[^0-1 .]/i.test(this.value)){this.value=this.value.substr(0,this.value.length-1);}"></textarea>
                        <div class="data">
                            <b>Количество переменных</b><br>
                            <select name="NumOfVars" onchange="ValNumChange(document.DataInput.NumOfVars.value); ReloadKC();">
                                <option value="1" > 1 переменная </option> 
                                <option value="2" > 2 переменные </option>
                                <option value="3" > 3 переменные </option> 
                                <option value="4" selected> 4 переменные </option> 
                                <option value="5" > 5 переменные </option>
                                <option value="6" > 6 переменные </option>
                            </select>
                            <p>
                            <b>Метод минимизации</b><br>
                            <input name="MM" type="radio" value="1" checked>
                            МДНФ<br>
                            <input name="MM" type="radio" value="0">
                            МКНФ 
                            </p>
                            <input type="button" value="Вычислить" onclick="ReloadValues(); GROUPS = calculate(); list_of_groups = MakeLogExpression(GROUPS); Group(GROUPS); document.OutputData.ret.value = list_of_groups.join(out_br);"> 
                        </div>
                    </form>    
                </fieldset>        
            </div>
            
            <div id="karnaugh">
                <fieldset>
                    <legend>Карта Карно</legend>
					<div id="container"></div>
					<form name="KarnaughSets">
						<div id = "KarnaughSetings">
							Прозрачность полукарт
							<input type="range" name="PlaneOpacity" min="0" max="1" step="0.01" value="0.7" onChange="ChangePLanes(document.KarnaughSets.PlaneOpacity.value);">
							Прозрачность пустых ячеек
							<input type="range" name="EmptyCellOpacity" min="0" max="1" step="0.01" value="1" onChange="ChangeCells(document.KarnaughSets.EmptyCellOpacity.value);">
							<div id="group" ></div>
						</div>
						
					</form>
					<canvas id="2DimKC" height="460px" width="400px" margin="0" ></canvas>
				</fieldset>
            </div>
            
            <div id="output">    
                <fieldset>
                    <legend>Вывод</legend>
                    <form name="OutputData">
                        <textarea id="ret" readonly="true"></textarea>
						
                    </form> 
                </fieldset>
            </div>
        </div>
		<div id="author"><h4>Составитель логических выражений © 2015</h4></div> 
		
        <script src="Karnaugh.js"></script>
		<script src="three/three.min.js"></script>
		<script src="three/Projector.js"></script>
		
		<script src="three/TextGeometry.js"></script>
		<script src="three/FontUtils.js"></script>
		<script src="three/gentilis_regular.typeface.js"></script>
		<script>
			var container;
			var expression;

			var camera, scene, renderer;
			var cube, plane;

			var targetRotationX = 0;
			var targetRotationOnMouseDownX = 0;
			
			var targetRotationY = 0;
			var targetRotationOnMouseDownY = 0;
			
			var mouseX = 0;
			var mouseXOnMouseDown = 0;
			
			var mouseY = 0;
			var mouseYOnMouseDown = 0;
			
			var windowHalfX = 100;
			var windowHalfY = 100;
			
			var NumOfVars = document.DataInput.NumOfVars.value;
			var BinPow = Math.pow(2,NumOfVars);
			var size = 20;
			var gap = 4;
			var gap_plus_size = size + gap;
			
			var PlaneOpacity = 0.7;
			var GROUPS = [];
			var list_of_groups = [];
			
			var cell_groups = [];
			var poses = [[[1,0],[0,0]],
			[[1,1],[1,0],[0,1],[0,0]],
			[[3,1],[2,1],[3,0],[2,0],[0,1],[1,1],[0,0],[1,0]],
			[[3,3],[3,2],[2,3],[2,2],[3,0],[3,1],[2,0],[2,1],[0,3],[0,2],[1,3],[1,2],[0,0],[0,1],[1,0],[1,1]],
			[[7,3],[6,3],[7,2],[6,2],[4,3],[5,3],[4,2],[5,2],[7,0],[6,0],[7,1],[6,1],[4,0],[5,0],[4,1],[5,1],
				[0,3],[1,3],[0,2],[1,2],[3,3],[2,3],[3,2],[2,2],[0,0],[1,0],[0,1],[1,1],[3,0],[2,0],[3,1],[2,1]],
			[[7,7],[7,6],[6,7],[6,6],[7,4],[7,5],[6,4],[6,5],[4,7],[4,6],[5,7],[5,6],[4,4],[4,5],[5,4],[5,5],
				[7,0],[7,1],[6,0],[6,1],[7,3],[7,2],[6,3],[6,2],[4,0],[4,1],[5,0],[5,1],[4,3],[4,2],[5,3],[5,2],
				[0,7],[0,6],[1,7],[1,6],[0,4],[0,5],[1,4],[1,5],[3,7],[3,6],[2,7],[2,6],[3,4],[3,5],[2,4],[2,5],
				[0,0],[0,1],[1,0],[1,1],[0,3],[0,2],[1,3],[1,2],[3,0],[3,1],[2,0],[2,1],[3,3],[3,2],[2,3],[2,2]]];

			var groupCubes = new THREE.Group();
			var groupPlanes = new THREE.Group();
			
			var canvas = document.getElementById("2DimKC");
			var ctx = canvas.getContext("2d");
			
			var colors_2D = ["#440088","#ff0088","#0000A0","#008844","#00ffff","#00ff44","#004400","#880044","#888800"]
			
			var colors = [[0.5,0,1],[2,0,1],[0,0,1.25],[0,1,0.5],[0,2,2],[0,2,0.5],[0,0.5,0],[1,0,0.5],[1,1,0],[0.5,0,0],[0,0.5,0.5],[2,0,0],[2,0.25,0.5],[2,1,0],[0.125,0.125,0.125],[2,0.5,1]];
			
			var group_colors = [];
			
			//var cur_year = 1970+Math.floor(new Date().getTime()/(1000*60*60*24*365));
			//alert("Год:" + cur_year);
			
			init();
			animate();
			
			//Инициализация рабочей области
			function init()
			{
				//Инициализация контейнера
				container = document.getElementById('container');
				
				//Камера
				camera = new THREE.PerspectiveCamera( 70, 1, 1, 1000 );
				camera.position.z = 100 + 20*(NumOfVars);
				
				//Создание сцены
				scene = new THREE.Scene();
							
				//Вычисление разположения и размеров объектов сцены
				var MaxCount = [1,1,1];
				var MaxCountPx = [1,1,1];
				
				for(var i = 0; i < NumOfVars; i++)
					MaxCountPx[i%3] *= 2;
				
				for(i = 2; i + 1; i--)
					MaxCount[i] = (MaxCountPx[i] - 1)*(gap_plus_size)/2;
									
				var buf = MaxCountPx.shift();
				MaxCountPx.push(buf);
				
				//Создание полукарт
				Plane(MaxCount,MaxCountPx);
				
				//Создание ячеек
				Cube(MaxCount)
								
				//Вывод созданных элементов на сцену
				scene.add(groupCubes);
				scene.add(groupPlanes);
				
				drawKarnaughcard(NumOfVars);
				drawHalfCards(NumOfVars);
				
				//Создание рендерера
				renderer = new THREE.WebGLRenderer();
				renderer.setClearColor(0xffffff);
				renderer.setSize(400, 400);
				container.appendChild(renderer.domElement);
			
				//События мыши для вращения КК
				container.addEventListener('mousedown', onDocumentMouseDown, false);
				container.addEventListener('touchstart', onDocumentTouchStart, false);
				container.addEventListener('touchmove', onDocumentTouchMove, false);
				
				//Событие изменения размера окна
				window.addEventListener('resize', onWindowResize, false);
				console.log(scene)
			}
			
			//Визуализация групп ячеек 
			function Group(groups)//3 4 5 6
			{
				var size = 45;
				if(NumOfVars > 4)
					size = 35;
					
				console.log(list_of_groups)
				ctx.globalAlpha = 0.5;
				for(var group = 0; group < groups.length; group++)
				{
					
					ctx.fillStyle = colors_2D[group];
					for(var cell = 0; cell < groups[group].length; cell++)
					{
						cell_groups[groups[group][cell]].push(colors_2D[group]);
						ctx.fillRect(41 +poses[NumOfVars-1][groups[group][cell]][0]*size,41 + poses[NumOfVars-1][groups[group][cell]][1]*size + (NumOfVars>4)*30,size-6,size-6);
					
						groupCubes.children[groups[group][cell]].material.color.r *= group_colors[groups[group][cell]];
						groupCubes.children[groups[group][cell]].material.color.g *= group_colors[groups[group][cell]];
						groupCubes.children[groups[group][cell]].material.color.b *= group_colors[groups[group][cell]];
						
						group_colors[groups[group][cell]]++;
						
						groupCubes.children[groups[group][cell]].material.color.r += colors[group%16][0];
							
						groupCubes.children[groups[group][cell]].material.color.r /= group_colors[groups[group][cell]];
							
						groupCubes.children[groups[group][cell]].material.color.g += colors[group%16][1];
							
						groupCubes.children[groups[group][cell]].material.color.g /= group_colors[groups[group][cell]];
						
						groupCubes.children[groups[group][cell]].material.color.b += colors[group%16][2];
							
						groupCubes.children[groups[group][cell]].material.color.b /= group_colors[groups[group][cell]];
					
					}
					document.getElementById('group').innerHTML += '<p><input type="checkbox" name="group' + group + '" value="' + group + '" onchange="onGroupChange2D(document.KarnaughSets.group' + group + ');onGroupChange3D(document.KarnaughSets.group' + group + ')" checked>' + list_of_groups[group] + '</p>';
				}
			}
			
			function onGroupChange3D(group)
			{
				for(var cell = 0; cell < GROUPS[group.value].length; cell++) 
				{

					groupCubes.children[GROUPS[group.value][cell]].material.color.r *= group_colors[GROUPS[group.value][cell]];
					groupCubes.children[GROUPS[group.value][cell]].material.color.g *= group_colors[GROUPS[group.value][cell]];
					groupCubes.children[GROUPS[group.value][cell]].material.color.b *= group_colors[GROUPS[group.value][cell]];
					
					groupCubes.children[GROUPS[group.value][cell]].material.color.r += Math.pow(-1,!group.checked)*colors[group.value%16][0];
					groupCubes.children[GROUPS[group.value][cell]].material.color.g += Math.pow(-1,!group.checked)*colors[group.value%16][1];
					groupCubes.children[GROUPS[group.value][cell]].material.color.b += Math.pow(-1,!group.checked)*colors[group.value%16][2];
					
					group_colors[GROUPS[group.value][cell]] += Math.pow(-1,!group.checked);
						
					groupCubes.children[GROUPS[group.value][cell]].material.color.r /= group_colors[GROUPS[group.value][cell]];
					groupCubes.children[GROUPS[group.value][cell]].material.color.g /= group_colors[GROUPS[group.value][cell]];
					groupCubes.children[GROUPS[group.value][cell]].material.color.b /= group_colors[GROUPS[group.value][cell]];

				}
			}
			
			//Изменение яркости полукарт
			function ChangePLanes(NewOpacity)
			{
				for(var child = 0; child < groupPlanes.children.length; child++)
					groupPlanes.children[child].material.opacity = NewOpacity;  
			}
			
			//Изменение прозрачности пустых ячеек
			function ChangeCells(NewOpacity)
			{
				var BinPow = Math.pow(2,NumOfVars);
				var ExpressionValue = document.DataInput.MM.value;
				for(var child = 0; child < BinPow; child++)
					if(expression[child] != ExpressionValue)
					{
						groupCubes.children[child].material.opacity = NewOpacity;
						groupCubes.children[child+BinPow].material.opacity = NewOpacity;
					}
			}
			
			//Переинициализация
			function ReloadKC()
			{
				NumOfVars = document.DataInput.NumOfVars.value;
				BinPow = Math.pow(2,NumOfVars);
				PlaneOpacity = document.KarnaughSets.PlaneOpacity.value;
				
				ctx.clearRect(0,0,1000,1000);
				ctx.globalAlpha = 1;
				cell_colors = [];
				
				groupCubes = new THREE.Group();
				groupPlanes = new THREE.Group();
				container.removeChild(renderer.domElement);
				document.getElementById('group').innerHTML = '';
				init();
				animate();
			}
			
			//Перезагрузка значений
			function ReloadValues()
			{
				NumOfVars = document.DataInput.NumOfVars.value;
				BinPow = Math.pow(2,NumOfVars);
				expression = document.DataInput.exp.value;
				//expression = '0123456789abcddefghijklmnopqrstuvw000000000000000000000000000000000000000000000000000123456789ABCDEFGHIJKLMNOPQRSTUVW'
				var pos = [0,0,0];
				
				groupCubes.children = groupCubes.children.slice(0,BinPow); 
				ctx.font = '30px sans-serif';
				ctx.strokeStyle = "black";
				ctx.globalAlpha = 1; 
				
				var size = 45;
				if(NumOfVars > 4)
				{
					size = 35;
					ctx.font = '20px sans-serif';
				}
				
				for(var child = 0; child < BinPow; child++)
				{
					groupCubes.children[child].material.color.r = 0.75;
					groupCubes.children[child].material.color.g = 0.75;
					groupCubes.children[child].material.color.b = 0.75;
					
					pos[0] = groupCubes.children[child].position.x - 5;
					pos[1] = groupCubes.children[child].position.y - 6;
					pos[2] = groupCubes.children[child].position.z - 1;					
					
					//Создание трехмерного текста
					var text3d = new THREE.TextGeometry(expression[child],{size: 15, height: 2, font: "gentilis", curveSegments: 1});
					//
					//!!!БАГ!!!
					//
						var TextMaterial = new THREE.MeshBasicMaterial({color: 0x000000, overdraw: 0.5, transparent:true});
					//
					//
					//
					text = new THREE.Mesh(text3d, TextMaterial);
					text.position.set(pos[0], pos[1], pos[2]);
					groupCubes.add(text);
					
					//Создание двухмерного текста
					ctx.fillText(expression[child],0.25*size + poses[NumOfVars-1][child][0]*size + 40,poses[NumOfVars-1][child][1]*size + 40 + (NumOfVars>4)*30 + 0.7*size);
				}
				ctx.stroke();

				scene.add(groupCubes);
				document.getElementById('group').innerHTML = '';
			}
			
			//Создание ячеек(3D)
			function Cube(MaxCount)
			{
				var pos = [0,0,0];
				var StartCount = [0,0,0];
				var end;
				
				BinPow > 8 ? end = 8 : end = BinPow;
						
				for(var shift = 0; shift < Math.ceil(BinPow/8); shift++)
				{
					var count = (NumOfVars-1)%3;
					if(shift == 0)
						for(var coor = 0; coor < 3; coor++)
						{
							StartCount[coor] = -MaxCount[coor];
							MaxCount[coor] -= (NumOfVars > 3+coor)*2*gap_plus_size;
						}
					
					
						
					if(shift%2 == 1)
					{
						StartCount[count] = -StartCount[count];
						MaxCount[count] = -MaxCount[count];
					}
						
					if(shift%4 == 2)
					{
						StartCount[count-1] = -StartCount[count-1];
						MaxCount[count-1] = -MaxCount[count-1];
						StartCount[count] = -StartCount[count];
						MaxCount[count] = -MaxCount[count];
					}
					
					if(shift%8 == 4)
					{
						StartCount[0] = -StartCount[0];
						MaxCount[0] = -MaxCount[0];
						StartCount[1] = -StartCount[1];
						MaxCount[1] = -MaxCount[1];
						StartCount[2] = -StartCount[2];
						MaxCount[2] = -MaxCount[2];
					}
					
					for(var coor = 0; coor < 3; coor++)
							pos[coor] = StartCount[coor];

					//for(var j = 0; j <= (NumOfVars-1)%3; j++)
					pos[count] -= Math.pow(-1,(shift%2))*gap_plus_size;
					
					for(var i = 0; i < end; i++)
					{
						var count = (NumOfVars-1)%3;
						while(pos[count] == MaxCount[count])
						{
							pos[count] = StartCount[count--];
							if(count < 0)
								count = 2;
						}
						
						var geometry = new THREE.BoxGeometry(size, size, size);
						var material = new THREE.MeshBasicMaterial({color: 0xc0c0c0/*map: THREE.ImageUtils.loadTexture('cell_texture.jpg')*/, opacity: 0.7,transparent: true, overdraw:0.5});
						pos[count] += Math.pow(-1,!(shift%Math.pow(2,(NumOfVars-3) + Math.pow(-1,NumOfVars > 4)*count)<Math.pow(2,(NumOfVars-4) + Math.pow(-1,NumOfVars > 4)*count)))*gap_plus_size;
						group_colors.push(1);
						cube = new THREE.Mesh(geometry, material);//							  	 							 	  + - + - + - + -				      + + - - + + - - 				     + + + + - - - -
						cube.position.set(pos[0], pos[1], pos[2]);
						groupCubes.add(cube);
					}
				}
			}
			
			//Создание плоскостей(3D)
			function Plane(MaxCount,MaxCountPx)
			{
				var text_pos = [];
				var TextMaterial = new THREE.MeshBasicMaterial({color: 0x000000, overdraw: 0.5, opacity: PlaneOpacity, transparent: true});
				var material = new THREE.MeshBasicMaterial({color: 0x757575, overdraw: 0.5, opacity: PlaneOpacity, transparent: true});
				var max = 2;
				//Вычисление расположения и размеров полукарт
				for(i = 0; i < NumOfVars; i++)
				{
					var not = '¬';
					var count = 2;
					var plane_size = [size + (MaxCountPx[i%3] - 1)*gap_plus_size,size + gap_plus_size*Math.floor(NumOfVars/(4 + i))];
					if(i < 3)
					{
						var num = -1;
						var plane_pos = [(gap_plus_size/2)*Math.ceil(NumOfVars/(3 + i)),0,- 30 - MaxCount[count]];
					}
					else
					{
						max = 3;
						var num = 1;
						var plane_pos = [gap_plus_size + size/2,0,30 + MaxCount[5-i]];
					}
					
					for(var iter = 0; iter < i%3; iter++)
					{
						var buf = plane_pos.pop();
						plane_pos.unshift(buf);
						count++;
						if(count > 2)
							count = 0;
					}
							
					plane_pos[count] = num*(30 + MaxCount[count]);
					
					for(var sign = 0; sign < max; sign ++)
					{
						plane_pos[i%3] *= -1;
						if(sign == 2)
						{
							not = '';
							plane_pos[i%3] = 0;
							plane_size[1] += gap_plus_size;
						}
						
						//Создание полукарты
						var geometry = new THREE.PlaneBufferGeometry(plane_size[0], plane_size[1]);
						angle_set = [0,0,0];
						angle_set[(5 - i)%3] = -Math.PI/2;
						plane = new THREE.Mesh(geometry, material);
						plane.material.side = THREE.DoubleSide;
						plane.rotation.set(angle_set[0], angle_set[1], angle_set[2])
						plane.position.set(plane_pos[0], plane_pos[1], plane_pos[2]);
						groupPlanes.add(plane);
						
						//Создание текста
						text_pos[0] = plane_pos[0]
						text_pos[1] = plane_pos[1]
						text_pos[2] = plane_pos[2]
						
						if(count != 0)
							text_pos[count-1] = MaxCount[count-1] + 20
						else
							text_pos[2] = MaxCount[2] + 20
							
						if((i<3)&&(sign == 1))
							not = '';
						
						var text3d = new THREE.TextGeometry(not + 'X' + i,{size: 5, height: 0.5, font: "gentilis", curveSegments: 1});
						text = new THREE.Mesh(text3d, TextMaterial);
						text.rotation.set(angle_set[0], angle_set[1], 0);
						text.position.set(text_pos[0], text_pos[1], text_pos[2]);
						groupPlanes.add(text);
				
					}
				}
			}
			
			function onGroupChange2D(group)
			{
				var size = 45;
				if(NumOfVars > 4)
				{
					size = 35;
					ctx.font = '20px sans-serif';
				}
				
				for(var cell = 0; cell < GROUPS[group.value].length; cell++) 
				{
					var RectX = poses[NumOfVars-1][GROUPS[group.value][cell]][0]*size;
					var RectY = poses[NumOfVars-1][GROUPS[group.value][cell]][1]*size;
					
					if(group.checked)
					{
						ctx.globalAlpha = 0.5;
						ctx.fillStyle = colors_2D[group.value];
						cell_groups[GROUPS[group.value][cell]].push(colors_2D[group.value]);
						ctx.fillRect(41 + RectX, 41 + RectY + (NumOfVars>4)*30, size-6, size-6);
						ctx.fillText(expression[GROUPS[group.value][cell]],0.25*size + RectX + 40,RectY + 40 + (NumOfVars>4)*30 + 0.7*size);

					}
					else
					{							
						ctx.clearRect(41 + RectX, 41 + RectY + (NumOfVars>4)*30,size-6,size-6);
						
						cell_groups[GROUPS[group.value][cell]] = RemoveByName(cell_groups[GROUPS[group.value][cell]], colors_2D[group.value])
						
						ctx.globalAlpha = 1;
						ctx.fillStyle = "black";
						
						
						ctx.fillText(expression[GROUPS[group.value][cell]],0.25*size + RectX + 40,RectY + 40 + (NumOfVars>4)*30 + 0.7*size);
							
						ctx.globalAlpha = 0.5;
						for(var color = 0; color < cell_groups[GROUPS[group.value][cell]].length; color++)
						{
							ctx.fillStyle = cell_groups[GROUPS[group.value][cell]][color];
							ctx.fillRect(41 + RectX, 41 + RectY + (NumOfVars>4)*30, size-6, size-6);
						}
					}
				}
			}
				
			function RemoveByName(array,value)
			{
				var piv = array.indexOf(value);
				return array.slice(0, piv).concat(array.slice(piv+1))
			}
				
			function drawHalfCards(NumOfVars)
			{
				var height = Math.pow(2, Math.floor(NumOfVars/2));
				var width = Math.pow(2, Math.ceil(NumOfVars/2));
				var size = 45;
				if(NumOfVars > 4)
					size = 35;
				
				ctx.font = '20px sans-serif';
				ctx.fillStyle = "black";
				ctx.beginPath();
				switch(NumOfVars)
				{
					case "6":
						//x5
						ctx.moveTo(80+width*size,70+height*size*0/8);
						ctx.lineTo(80+width*size,70+height*size*1/8 - 5);
						ctx.fillText('X' + '\u0305' + 5,80+width*size + 5,70+height*size*1/16 + 5);
							
						ctx.moveTo(80+width*size,70+height*size*1/8);
						ctx.lineTo(80+width*size,70+height*size*3/8 - 5);
						ctx.fillText('X' + 5,80+width*size + 5,70+height*size*4/16 + 5);
							
						ctx.moveTo(80+width*size,70+height*size*3/8);
						ctx.lineTo(80+width*size,70+height*size*5/8 - 5);
						ctx.fillText('X' + '\u0305' + 5,80+width*size + 5,70+height*size*8/16 + 5);
							
						ctx.moveTo(80+width*size,70+height*size*5/8);
						ctx.lineTo(80+width*size,70+height*size*7/8 - 5);
						ctx.fillText('X' + 5,980+width*size + 5,70+height*size*12/16 + 5);
						
						ctx.moveTo(80+width*size,70+height*size*7/8);
						ctx.lineTo(80+width*size,70+height*size*8/8 - 5);
						ctx.fillText('X' + '\u0305' + 5,80+width*size + 5,70+height*size*15/16 + 5);
							
					case "5":
						//x4
						ctx.moveTo(40+width*size*0/8,	35);
						ctx.lineTo(40+width*size*1/8 - 5,35);
						ctx.fillText('X' + '\u0305' + 4,40+width*size*1/16 - 10,30);
						
						ctx.moveTo(40+width*size*1/8,	35);
						ctx.lineTo(40+width*size*3/8 - 5,35);
						ctx.fillText('X' + 4,40+width*size*4/16 - 10,30);
							
						ctx.moveTo(40+width*size*3/8,	35);
						ctx.lineTo(40+width*size*5/8 - 5,35);
						ctx.fillText('X' + '\u0305' + 4,40+width*size*8/16 - 10,30);
							
						ctx.moveTo(40+width*size*5/8,	35);
						ctx.lineTo(40+width*size*7/8 - 5,35);
						ctx.fillText('X' + 4,40+width*size*12/16 - 10,30);
						
						ctx.moveTo(40+width*size*7/8,	35);
						ctx.lineTo(40+width*size*8/8 - 5,35);
						ctx.fillText('X' + '\u0305' + 4,40+width*size*15/16 - 10,30);
					
					case "4":
						//x3
						ctx.moveTo(35,40+height*size*0/4 + (NumOfVars>4)*30);
						ctx.lineTo(35,40+height*size*1/4 - 5 + (NumOfVars>4)*30);
						ctx.fillText('X' + '\u0305' + 3,5,40+height*size*1/8 + (NumOfVars>4)*30);
							
						ctx.moveTo(35,40+height*size*1/4 + (NumOfVars>4)*30);
						ctx.lineTo(35,40+height*size*3/4 - 5 + (NumOfVars>4)*30);
						ctx.fillText('X' + 3,5,40+height*size*4/8 + (NumOfVars>4)*30);
						
						ctx.moveTo(35,40+height*size*3/4 + (NumOfVars>4)*30);
						ctx.lineTo(35,40+height*size*4/4 - 5 + (NumOfVars>4)*30);
						ctx.fillText('X' + '\u0305' + 3,5,40+height*size*7/8 + (NumOfVars>4)*30);
						
					case "3":
						//x2
						ctx.moveTo(40+width*size*0/4,	40+height*size + (NumOfVars>4)*30);
						ctx.lineTo(40+width*size*1/4 - 5,40+height*size + (NumOfVars>4)*30);
						ctx.fillText('X' + '\u0305' + 2,40+width*size*1/8 - 10,40+height*size + 25 + (NumOfVars>4)*30);
							
						ctx.moveTo(40+width*size*1/4,	40+height*size + (NumOfVars>4)*30);
						ctx.lineTo(40+width*size*3/4 - 5,40+height*size + (NumOfVars>4)*30);
						ctx.fillText('X' + 2,40+width*size*4/8 - 10,40+height*size + 25 + (NumOfVars>4)*30);
						
						ctx.moveTo(40+width*size*3/4,	40+height*size + (NumOfVars>4)*30);
						ctx.lineTo(40+width*size*4/4 - 5,40+height*size + (NumOfVars>4)*30);
						ctx.fillText('X' + '\u0305' + 2,40+width*size*7/8 - 10,40+height*size + 25 + (NumOfVars>4)*30);
							
					case "2":
						//x1
						ctx.moveTo(40+width*size,40+height*size*0/2 + (NumOfVars>4)*30);
						ctx.lineTo(40+width*size,40+height*size*1/2 - 5 + (NumOfVars>4)*30);
						ctx.fillText('X' + 1,50+width*size,40+height*size*1/4 + (NumOfVars>4)*30);
							
						ctx.moveTo(40+width*size,40+height*size*1/2 + (NumOfVars>4)*30);
						ctx.lineTo(40+width*size,40+height*size*2/2 - 5 + (NumOfVars>4)*30);
						ctx.fillText('X' + '\u0305' + 1,50+width*size,40+height*size*3/4 + (NumOfVars>4)*30);
						
					case "1":
						//x0
						ctx.moveTo(40+width*size*0/2,35 + (NumOfVars>4)*30);
						ctx.lineTo(40+width*size*1/2 -5,35 + (NumOfVars>4)*30);
						ctx.fillText('X' + 0,40+width*size*1/4 - 10,30 + (NumOfVars>4)*30);
						
						ctx.moveTo(40+width*size*1/2 + (NumOfVars>5)*5,35 + (NumOfVars>4)*30);
						ctx.lineTo(40+width*size*2/2 - 5 + (NumOfVars>5)*5,35 + (NumOfVars>4)*30);
						ctx.fillText('X' + '\u0305' + 0,40+width*size*3/4  + (NumOfVars>5)*5 - 10,30 + (NumOfVars>4)*30);
				}
				
				ctx.stroke();
				ctx.closePath();
			}

			function drawKarnaughcard(NumOfVars)
			{
				var height = Math.pow(2, Math.floor(NumOfVars/2));
				var width = Math.pow(2, Math.ceil(NumOfVars/2));
				var size = 45;
				if(NumOfVars > 4)
					size = 35;
					
				function Cell(pos)
				{
					ctx.strokeRect(pos[0]*size + 40.5,pos[1]*size + 40.5 + (NumOfVars>4)*30, size-5, size-5);
				}
				
				ctx.font = '30px sans-serif';

				for(var i =0; i< Math.pow(2,NumOfVars);i++)
				{
					Cell(poses[NumOfVars-1][i]);
					cell_groups.push([]);
				}
			}
			
			function onWindowResize()
			{
				windowHalfX = 200;
				windowHalfY = 200;
				camera.aspect = 1;
				camera.updateProjectionMatrix();
				renderer.setSize(350, 350);
			}
 
			function onDocumentMouseDown(event)
			{
				event.preventDefault();
				container.addEventListener('mousemove', onDocumentMouseMove, false);
				container.addEventListener('mouseup', onDocumentMouseUp, false);
				container.addEventListener('mouseout', onDocumentMouseOut, false);
				mouseXOnMouseDown = event.clientX - windowHalfX;
				targetRotationOnMouseDownX = targetRotationX;
				mouseYOnMouseDown = event.clientY - windowHalfY;
				targetRotationOnMouseDownY = targetRotationY;
			}
 
			function onDocumentMouseMove(event)
			{
				mouseX = event.clientX - windowHalfX;
				mouseY = event.clientY - windowHalfY;
				targetRotationY = targetRotationOnMouseDownY + (mouseY - mouseYOnMouseDown) * 0.02;
				targetRotationX = targetRotationOnMouseDownX + (mouseX - mouseXOnMouseDown) * 0.02;
			}
 
			function onDocumentMouseUp(event)
			{
				container.removeEventListener('mousemove', onDocumentMouseMove, false);
				container.removeEventListener('mouseup', onDocumentMouseUp, false);
				container.removeEventListener('mouseout', onDocumentMouseOut, false);
			}
 
			function onDocumentMouseOut(event)
			{
				container.removeEventListener('mousemove', onDocumentMouseMove, false);
				container.removeEventListener('mouseup', onDocumentMouseUp, false);
				container.removeEventListener('mouseout', onDocumentMouseOut, false);
			}
 
			function onDocumentTouchStart(event)
			{
				if (event.touches.length == 1)
				{
					event.preventDefault();
					mouseXOnMouseDown = event.touches[ 0 ].pageX - windowHalfX;
					targetRotationOnMouseDownX = targetRotationX;
					mouseYOnMouseDown = event.touches[ 0 ].pageY - windowHalfY;
					targetRotationOnMouseDownY = targetRotationY;		 
				}
			}
 
			function onDocumentTouchMove(event)
			{
				if (event.touches.length == 1)
				{
					event.preventDefault();
					mouseX = event.touches[ 0 ].pageX - windowHalfX;
					targetRotationX = targetRotationOnMouseDownX + (mouseX - mouseXOnMouseDown) * 0.05;
					mouseY = event.touches[ 0 ].pageY - windowHalfY;
					targetRotationY = targetRotationOnMouseDownY + (mouseY - mouseYOnMouseDown) * 0.05;
				}
			}
 
			function animate()
			{
				requestAnimationFrame(animate);
				render();
			}
 
			function render()
			{
				//horizontal rotation   
				groupCubes.rotation.y += (targetRotationX - groupCubes.rotation.y) * 0.1;
				groupPlanes.rotation.y += (targetRotationX - groupPlanes.rotation.y) * 0.1;
				//vertical rotation 
				groupCubes.rotation.x += (targetRotationY - groupCubes.rotation.x) * 0.05;
				groupPlanes.rotation.x += (targetRotationY - groupPlanes.rotation.x) * 0.05;
				renderer.render(scene, camera);
			}
		</script>
    </body>
</html>